[gd_scene load_steps=28 format=3 uid="uid://b7n4mr7jqmxj1"]

[ext_resource type="Script" uid="uid://dyuc4i7fvrqg4" path="res://iffnsStuff/BoatsForGodot/Water/BoatMakingWaves/DepthManager.gd" id="1_ui8wu"]
[ext_resource type="Shader" uid="uid://j2v6p1314qrr" path="res://iffnsStuff/BoatsForGodot/Water/BoatMakingWaves/WaterSimulation.gdshader" id="2_3eroi"]
[ext_resource type="Shader" uid="uid://bft2cxdusw037" path="res://iffnsStuff/BoatsForGodot/Water/BoatMakingWaves/DepthLense.gdshader" id="3_hcycn"]
[ext_resource type="Shader" uid="uid://d0ghwtm5uceaa" path="res://iffnsStuff/BoatsForGodot/Water/BoatMakingWaves/Buffer.gdshader" id="4_kabla"]
[ext_resource type="Shader" uid="uid://b22ikjphjjmpp" path="res://iffnsStuff/BoatsForGodot/Water/Rivers/RiverDisplayTest.gdshader" id="5_sihjt"]
[ext_resource type="Texture2D" uid="uid://dwuiool6gvy31" path="res://iffnsStuff/BoatsForGodot/Water/Rivers/HeightmapSample.png" id="6_7oy5i"]
[ext_resource type="PackedScene" uid="uid://cffb6b4ojmkfs" path="res://iffnsStuff/BoatsForGodot/Prefabs/calculation_boat.tscn" id="6_urw7s"]
[ext_resource type="Script" uid="uid://ca6bxi2ph21ij" path="res://iffnsStuff/BoatsForGodot/InputSystem/Scripts/SetupInputs.gd" id="7_dn71r"]
[ext_resource type="Resource" uid="uid://dhc5nrjr5at4j" path="res://iffnsStuff/BoatsForGodot/InputSystem/Inputs/boat_controls.tres" id="8_78frg"]
[ext_resource type="Script" uid="uid://ct04fe6ty6nm6" path="res://iffnsStuff/BoatsForGodot/Water/Rivers/RiverLevelProvider.gd" id="10_7oy5i"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_sceo6"]
sky_horizon_color = Color(0.66224277, 0.6717428, 0.6867428, 1)
ground_horizon_color = Color(0.66224277, 0.6717428, 0.6867428, 1)

[sub_resource type="Sky" id="Sky_gt0sd"]
sky_material = SubResource("ProceduralSkyMaterial_sceo6")

[sub_resource type="Environment" id="Environment_ai1qr"]
background_mode = 2
sky = SubResource("Sky_gt0sd")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="ViewportTexture" id="ViewportTexture_obvp1"]
viewport_path = NodePath("WaterWithWavesSimulation/DepthRenderer")

[sub_resource type="ViewportTexture" id="ViewportTexture_3ur6q"]
viewport_path = NodePath("WaterWithWavesSimulation/WaterBuffer")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_elf7b"]
resource_local_to_scene = true
shader = ExtResource("2_3eroi")
shader_parameter/waveSpeed = 0.2
shader_parameter/dampening = 0.999
shader_parameter/offsetX = 0.0
shader_parameter/offsetY = 0.0
shader_parameter/initializationFactor = 0.0
shader_parameter/water_buffer = SubResource("ViewportTexture_3ur6q")
shader_parameter/depth_tex = SubResource("ViewportTexture_obvp1")

[sub_resource type="QuadMesh" id="QuadMesh_rdm35"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_1oyda"]
resource_local_to_scene = true
render_priority = 0
shader = ExtResource("3_hcycn")
shader_parameter/cam_near = 1.0
shader_parameter/cam_far = 3.0

[sub_resource type="ViewportTexture" id="ViewportTexture_4asyk"]
viewport_path = NodePath("WaterWithWavesSimulation/WaterSim")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_3ur6q"]
resource_local_to_scene = true
shader = ExtResource("4_kabla")
shader_parameter/simulation = SubResource("ViewportTexture_4asyk")

[sub_resource type="QuadMesh" id="QuadMesh_08lmn"]
size = Vector2(100, 100)
subdivide_width = 100
subdivide_depth = 100

[sub_resource type="ViewportTexture" id="ViewportTexture_0b1lw"]
viewport_path = NodePath("WaterWithWavesSimulation/WaterSim")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_4asyk"]
resource_local_to_scene = true
render_priority = 0
shader = ExtResource("5_sihjt")
shader_parameter/max_height = 10.0
shader_parameter/heightmap = ExtResource("6_7oy5i")
shader_parameter/albedo = Color(0, 0.7490196, 0.9411765, 1)
shader_parameter/metalic = 0.8
shader_parameter/roughness = 0.2
shader_parameter/depth_tex = SubResource("ViewportTexture_0b1lw")
shader_parameter/effect_texture_size = Vector2(512, 512)
shader_parameter/normal_strength = 5.000000074506
shader_parameter/sample_distance = 1.5000000074506
shader_parameter/smoothness = 1.0

[sub_resource type="QuadMesh" id="QuadMesh_sceo6"]
size = Vector2(500, 500)
subdivide_width = 100
subdivide_depth = 100

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_ai1qr"]
albedo_color = Color(0, 0.7490196, 0.9411765, 1)
metallic = 0.8
roughness = 0.2

[sub_resource type="ViewportTexture" id="ViewportTexture_vtyt1"]
viewport_path = NodePath("WaterWithWavesSimulation/DepthRenderer")

[sub_resource type="ViewportTexture" id="ViewportTexture_haqpc"]
viewport_path = NodePath("WaterWithWavesSimulation/WaterBuffer")

[node name="ObjectImpactTest" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_ai1qr")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(-0.25595093, 0.51554674, -0.81774116, 0.15399797, 0.8568614, 0.49200922, 0.95434475, -2.7014084e-07, -0.29870763, 0, 4.29137, 0)
light_color = Color(0.89, 0.89, 1, 1)

[node name="WaterWithWavesSimulation" type="Node3D" parent="." node_paths=PackedStringArray("depth_camera", "reference_boat", "water_quad")]
script = ExtResource("1_ui8wu")
simulation_shader = SubResource("ShaderMaterial_elf7b")
depth_camera = NodePath("DepthRenderer/DepthCamera")
reference_boat = NodePath("../CalculationBoat")
water_quad = NodePath("Water plane with waves")
should_update_position = false

[node name="DepthRenderer" type="SubViewport" parent="WaterWithWavesSimulation"]
size_2d_override_stretch = true
render_target_update_mode = 4

[node name="DepthCamera" type="Camera3D" parent="WaterWithWavesSimulation/DepthRenderer"]
transform = Transform3D(1, 0, 0, 0, -4.371139e-08, -1, 0, 1, -4.371139e-08, 0, -4, 0)
cull_mask = 1
projection = 1
size = 100.0
near = 1.0
far = 4.0

[node name="DepthLens" type="MeshInstance3D" parent="WaterWithWavesSimulation/DepthRenderer/DepthCamera"]
transform = Transform3D(100, 0, 0, 0, 100, 0, 0, 0, 100, 0, -2.7755576e-15, -1.3502748)
mesh = SubResource("QuadMesh_rdm35")
surface_material_override/0 = SubResource("ShaderMaterial_1oyda")

[node name="WaterSim" type="SubViewport" parent="WaterWithWavesSimulation"]
disable_3d = true
use_hdr_2d = true
render_target_update_mode = 4

[node name="ColorRect" type="ColorRect" parent="WaterWithWavesSimulation/WaterSim"]
material = SubResource("ShaderMaterial_elf7b")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="WaterBuffer" type="SubViewport" parent="WaterWithWavesSimulation"]
disable_3d = true
use_hdr_2d = true
render_target_update_mode = 4

[node name="ColorRect" type="ColorRect" parent="WaterWithWavesSimulation/WaterBuffer"]
material = SubResource("ShaderMaterial_3ur6q")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="Water plane with waves" type="MeshInstance3D" parent="WaterWithWavesSimulation"]
transform = Transform3D(1, 0, 0, 0, -4.371139e-08, 1, 0, -1, -4.371139e-08, 0.19139457, -0.076165676, -0.06105852)
mesh = SubResource("QuadMesh_08lmn")
skeleton = NodePath("../..")
surface_material_override/0 = SubResource("ShaderMaterial_4asyk")

[node name="Water plane distance" type="MeshInstance3D" parent="WaterWithWavesSimulation"]
transform = Transform3D(1, 0, 0, 0, -4.371139e-08, 1, 0, -1, -4.371139e-08, 0, -0.1, 0)
visible = false
mesh = SubResource("QuadMesh_sceo6")
skeleton = NodePath("../..")
surface_material_override/0 = SubResource("StandardMaterial3D_ai1qr")

[node name="CalculationBoat" parent="." node_paths=PackedStringArray("_water_level") instance=ExtResource("6_urw7s")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 30.910225, 0, 24.792559)
_water_level = NodePath("../EditorWaterLevel")

[node name="Camera3D" type="Camera3D" parent="CalculationBoat"]
transform = Transform3D(1, 0, 0, 0, 0.9346024, 0.35569423, 0, -0.35569423, 0.9346024, 0, 3.161384, 7.367585)

[node name="Output on sprite" type="Sprite3D" parent="CalculationBoat"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3.2165217, 5.98899, -10.495203)
texture = SubResource("ViewportTexture_vtyt1")

[node name="Water buffer output" type="Sprite3D" parent="CalculationBoat"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -2.7594602, 5.98899, -10.495203)
texture = SubResource("ViewportTexture_haqpc")

[node name="SetupInputs" type="Node" parent="."]
script = ExtResource("7_dn71r")
input_collection = ExtResource("8_78frg")

[node name="EditorWaterLevel" type="Node" parent="."]
script = ExtResource("10_7oy5i")
heightmap = ExtResource("6_7oy5i")
grid_size = 500.0
max_height = 10.0

[node name="CSGBox3D" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -21.96959, 3.9081764, -42.529503)
size = Vector3(10, 10, 10)

[node name="CSGBox3D2" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 30.524933, 3.9081764, -69.11095)
size = Vector3(10, 10, 10)

[node name="CSGBox3D3" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -78.06027, 3.9081764, -123.942955)
size = Vector3(10, 10, 10)

[node name="CSGBox3D4" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -126.993164, 3.9081726, -60.49095)
size = Vector3(10, 10, 10)

[node name="CSGBox3D5" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 20.20929, 3.9081764, -161.69623)
size = Vector3(10, 10, 10)
